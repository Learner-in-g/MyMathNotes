<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dynamic Math: Tangent & Derivative Explorer</title>
  <style>
    :root { color-scheme: dark; }
    body { margin: 0; font-family: system-ui, Segoe UI, Arial, sans-serif; background:#0b0f14; color:#e8eef7; }
    header { padding: 18px 16px; border-bottom: 1px solid #1e2a3a; background:#0b0f14; position: sticky; top: 0; }
    header h1 { margin: 0; font-size: 18px; }
    header p { margin: 6px 0 0; opacity: .8; font-size: 13px; }
    main { display: grid; grid-template-columns: 340px 1fr; gap: 14px; padding: 14px; max-width: 1200px; margin: 0 auto; }
    @media (max-width: 900px){ main { grid-template-columns: 1fr; } }

    .card { background:#101826; border:1px solid #1e2a3a; border-radius: 14px; padding: 14px; box-shadow: 0 6px 20px rgba(0,0,0,.25); }
    .row { display:flex; gap:10px; align-items:center; justify-content: space-between; }
    label { font-size: 13px; opacity: .9; }
    select, input[type="range"], input[type="number"] {
      width: 100%;
      accent-color: #6ea8ff;
    }
    input[type="number"]{
      background:#0b0f14; color:#e8eef7; border:1px solid #1e2a3a; border-radius:10px; padding:8px 10px;
    }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .stat { padding: 10px; border-radius: 12px; border:1px solid #1e2a3a; background:#0b0f14; }
    .hint { font-size: 12px; opacity: .75; line-height: 1.35; }
    canvas { width: 100%; height: 540px; border-radius: 14px; border: 1px solid #1e2a3a; background:#0b0f14; display:block; }
    .btnrow { display:flex; gap:10px; }
    button{
      cursor:pointer; border:1px solid #1e2a3a; background:#0b0f14; color:#e8eef7;
      padding:10px 12px; border-radius: 12px; font-weight:600;
    }
    button:hover{ border-color:#34527a; }
    .small { font-size: 12px; opacity: .85; }
  </style>
</head>
<body>
<header>
  <h1>Dynamic Math: Tangent & Derivative Explorer</h1>
  <p>Pick a function, move <span class="mono">x₀</span>, and watch the tangent line + derivative update in real time.</p>
</header>

<main>
  <section class="card">
    <div class="row" style="gap:12px;">
      <div style="flex:1;">
        <label for="fn">Function f(x)</label>
        <select id="fn">
          <option value="x2">f(x) = x²</option>
          <option value="x3">f(x) = x³</option>
          <option value="sin">f(x) = sin(x)</option>
          <option value="cos">f(x) = cos(x)</option>
          <option value="exp">f(x) = e^x</option>
          <option value="ln1p">f(x) = ln(1 + x)  (domain: x > -1)</option>
        </select>
      </div>
    </div>

    <div style="height:12px;"></div>

    <label for="x0">Point x₀</label>
    <input id="x0" type="range" min="-6" max="6" step="0.01" />
    <div class="row small">
      <span class="mono" id="x0val"></span>
      <span class="hint">Drag slider</span>
    </div>

    <div style="height:10px;"></div>

    <label for="h">Step h (for numerical derivative)</label>
    <input id="h" type="range" min="0.0001" max="1" step="0.0001" />
    <div class="row small">
      <span class="mono" id="hval"></span>
      <span class="hint">Smaller h → better (until floating-point bites)</span>
    </div>

    <div style="height:12px;"></div>

    <div class="grid">
      <div class="stat">
        <div class="small">f(x₀)</div>
        <div class="mono" id="fx0">—</div>
      </div>
      <div class="stat">
        <div class="small">Tangent slope f′(x₀)</div>
        <div class="mono" id="slope">—</div>
      </div>
      <div class="stat">
        <div class="small">Numerical derivative</div>
        <div class="mono" id="numd">—</div>
      </div>
      <div class="stat">
        <div class="small">Tangent line</div>
        <div class="mono" id="tline">—</div>
      </div>
    </div>

    <div style="height:12px;"></div>

    <div class="btnrow">
      <button id="reset">Reset view</button>
      <button id="center">Center on x₀</button>
    </div>

    <div style="height:12px;"></div>
    <div class="hint">
      Uses a Canvas plot (no libraries). The numerical derivative is the symmetric difference:
      <span class="mono">(f(x₀+h) − f(x₀−h)) / (2h)</span>.
    </div>
  </section>

  <section class="card">
    <canvas id="plot" width="1100" height="700"></canvas>
  </section>
</main>

<script>
(() => {
  const canvas = document.getElementById('plot');
  const ctx = canvas.getContext('2d');

  const fnSel = document.getElementById('fn');
  const x0 = document.getElementById('x0');
  const h = document.getElementById('h');

  const x0val = document.getElementById('x0val');
  const hval = document.getElementById('hval');
  const fx0El = document.getElementById('fx0');
  const slopeEl = document.getElementById('slope');
  const numdEl = document.getElementById('numd');
  const tlineEl = document.getElementById('tline');

  const resetBtn = document.getElementById('reset');
  const centerBtn = document.getElementById('center');

  // World/view settings
  let view = { xmin: -6, xmax: 6, ymin: -6, ymax: 6 };

  function fFactory(kind){
    switch(kind){
      case 'x2': return { f: x => x*x, df: x => 2*x, name: 'x²' };
      case 'x3': return { f: x => x*x*x, df: x => 3*x*x, name: 'x³' };
      case 'sin': return { f: x => Math.sin(x), df: x => Math.cos(x), name: 'sin(x)' };
      case 'cos': return { f: x => Math.cos(x), df: x => -Math.sin(x), name: 'cos(x)' };
      case 'exp': return { f: x => Math.exp(x), df: x => Math.exp(x), name: 'e^x' };
      case 'ln1p': return { f: x => Math.log1p(x), df: x => 1/(1+x), name: 'ln(1+x)' };
      default: return { f: x => x*x, df: x => 2*x, name: 'x²' };
    }
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
  function isFiniteNumber(v){ return Number.isFinite(v); }

  function worldToScreenX(x){
    return (x - view.xmin) / (view.xmax - view.xmin) * canvas.width;
  }
  function worldToScreenY(y){
    return canvas.height - (y - view.ymin) / (view.ymax - view.ymin) * canvas.height;
  }

  function drawAxes(){
    ctx.save();
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // background grid
    ctx.strokeStyle = '#162235';
    ctx.lineWidth = 1;
    for(let i=0;i<=12;i++){
      const x = i/12 * canvas.width;
      ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
    }
    for(let i=0;i<=10;i++){
      const y = i/10 * canvas.height;
      ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
    }

    // axes
    ctx.strokeStyle = '#2b3f5c';
    ctx.lineWidth = 2;

    // y-axis at x=0
    if(view.xmin <= 0 && view.xmax >= 0){
      const xs = worldToScreenX(0);
      ctx.beginPath(); ctx.moveTo(xs,0); ctx.lineTo(xs,canvas.height); ctx.stroke();
    }
    // x-axis at y=0
    if(view.ymin <= 0 && view.ymax >= 0){
      const ys = worldToScreenY(0);
      ctx.beginPath(); ctx.moveTo(0,ys); ctx.lineTo(canvas.width,ys); ctx.stroke();
    }
    ctx.restore();
  }

  function drawFunction(f){
    ctx.save();
    ctx.strokeStyle = '#6ea8ff';
    ctx.lineWidth = 3;
    ctx.beginPath();

    let started = false;
    const N = 1200;
    for(let i=0;i<=N;i++){
      const x = view.xmin + (i/N)*(view.xmax - view.xmin);
      let y = f(x);
      if(!isFiniteNumber(y)) { started = false; continue; }
      // clip extreme spikes
      if(y < view.ymin*5 || y > view.ymax*5) { started = false; continue; }

      const xs = worldToScreenX(x);
      const ys = worldToScreenY(y);
      if(!started){ ctx.moveTo(xs,ys); started = true; }
      else ctx.lineTo(xs,ys);
    }
    ctx.stroke();
    ctx.restore();
  }

  function drawTangent(x0, fx0, slope){
    // y = slope*(x - x0) + fx0
    ctx.save();
    ctx.strokeStyle = '#ffd36e';
    ctx.lineWidth = 2.5;
    ctx.setLineDash([10,8]);

    const y1 = slope*(view.xmin - x0) + fx0;
    const y2 = slope*(view.xmax - x0) + fx0;

    ctx.beginPath();
    ctx.moveTo(worldToScreenX(view.xmin), worldToScreenY(y1));
    ctx.lineTo(worldToScreenX(view.xmax), worldToScreenY(y2));
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.restore();
  }

  function drawPoint(x, y){
    ctx.save();
    ctx.fillStyle = '#ff6ea8';
    ctx.strokeStyle = '#0b0f14';
    ctx.lineWidth = 3;

    const xs = worldToScreenX(x);
    const ys = worldToScreenY(y);
    ctx.beginPath();
    ctx.arc(xs, ys, 7, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();
    ctx.restore();
  }

  function format(v){
    if(!isFiniteNumber(v)) return 'undefined';
    const abs = Math.abs(v);
    if(abs >= 1000) return v.toExponential(4);
    if(abs < 0.0001 && abs !== 0) return v.toExponential(4);
    return v.toFixed(6);
  }

  function autoYRange(f){
    // pick y-range based on sampling
    let ymin = Infinity, ymax = -Infinity;
    const N = 400;
    for(let i=0;i<=N;i++){
      const x = view.xmin + (i/N)*(view.xmax - view.xmin);
      const y = f(x);
      if(!isFiniteNumber(y)) continue;
      ymin = Math.min(ymin, y);
      ymax = Math.max(ymax, y);
    }
    if(!isFiniteNumber(ymin) || !isFiniteNumber(ymax) || ymin === ymax){
      return { ymin: -6, ymax: 6 };
    }
    const pad = 0.18*(ymax - ymin) || 1;
    return { ymin: ymin - pad, ymax: ymax + pad };
  }

  function refresh(){
    const kind = fnSel.value;
    const { f, df } = fFactory(kind);

    let x0v = parseFloat(x0.value);
    let hv = parseFloat(h.value);

    // Domain guard for ln(1+x)
    if(kind === 'ln1p'){
      x0v = Math.max(x0v, -0.99);
      x0.value = x0v;
    }

    x0val.textContent = `x₀ = ${x0v.toFixed(4)}`;
    hval.textContent  = `h = ${hv.toFixed(4)}`;

    const fx0 = f(x0v);
    const slope = df(x0v);

    const numd = (f(x0v + hv) - f(x0v - hv)) / (2*hv);

    fx0El.textContent = format(fx0);
    slopeEl.textContent = format(slope);
    numdEl.textContent = format(numd);

    // tangent line y = m x + b
    const b = fx0 - slope*x0v;
    tlineEl.textContent = `y = ${format(slope)}·x + ${format(b)}`;

    // update y-range for nicer view
    const yr = autoYRange(f);
    view.ymin = yr.ymin;
    view.ymax = yr.ymax;

    drawAxes();
    drawFunction(f);

    if(isFiniteNumber(fx0) && isFiniteNumber(slope)){
      drawTangent(x0v, fx0, slope);
      drawPoint(x0v, fx0);
    }

    // HUD text
    ctx.save();
    ctx.fillStyle = '#e8eef7';
    ctx.globalAlpha = 0.85;
    ctx.font = '16px ui-monospace, Menlo, Consolas, monospace';
    ctx.fillText(`f(x) selected: ${kind}`, 16, 26);
    ctx.fillText(`x₀=${x0v.toFixed(4)}  f(x₀)=${format(fx0)}  f'(x₀)=${format(slope)}  num≈${format(numd)}`, 16, 48);
    ctx.restore();
  }

  // Defaults
  x0.value = "1.2";
  h.value = "0.02";

  fnSel.addEventListener('change', refresh);
  x0.addEventListener('input', refresh);
  h.addEventListener('input', refresh);

  resetBtn.addEventListener('click', () => {
    view = { xmin: -6, xmax: 6, ymin: -6, ymax: 6 };
    refresh();
  });

  centerBtn.addEventListener('click', () => {
    const x0v = parseFloat(x0.value);
    const width = view.xmax - view.xmin;
    view.xmin = x0v - width/2;
    view.xmax = x0v + width/2;
    refresh();
  });

  // Basic zoom with mouse wheel
  canvas.addEventListener('wheel', (e) => {
    e.preventDefault();
    const zoom = e.deltaY < 0 ? 0.9 : 1.1;
    const mx = e.offsetX / canvas.width;
    const wx = view.xmin + mx*(view.xmax - view.xmin);

    const newW = (view.xmax - view.xmin) * zoom;
    view.xmin = wx - mx*newW;
    view.xmax = wx + (1-mx)*newW;
    refresh();
  }, { passive:false });

  refresh();
})();
</script>
</body>
</html>
